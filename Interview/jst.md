Situation（背景）：做这个项目的背景是什么，比如这是个人项目还是团队项目，为什么需要做这个
项目，你的角色是什么，等等。
Target（目标）：该项目要达成的目标是什么？为了完成这个目标有哪些困难？
Action（行动）：针对所要完成目标，你做了哪些工作？如何克服了其中一些困难？
Result（结果）：项目最终结果如何？有哪些成就？有哪些不足之处可以改进？

# 京数通

项目名称：京数通
技术栈：Vue3 + TypeScript + Vite + Less + Antdv + Qiankun + Vitest
项目描述：

- 京数通是一款广告数据分析运营平台，通过对零售海量广告业务数据的加工和呈现，为用户提供各种详细指标维度的数据分析、数据监控等服务，是一站式 Saas 化的数据可视化系统
- 设计以 Qiankun 作为微前端框架并开发京数通为主应用，期间共有三个组内系统接入以及多个外部门系统接入子应用。
- 个人主要负责中国式日报、数据订阅、自定义看板、智能预警、智能问答等业务模块开发

## 项目介绍

京数通是京东零售广告部门的数据分析运营平台，主要面向全体零售的运营、销售、分析师等用户。通过对零售海量广告业务数据的加工和呈现，为用户提供各种详细的维度（产品线、事业群）指标（展点消、财收）的数据报表和趋势图分析能力、智能预警能力等。我主要负责该项目的日常及大促需求迭代，包括支持微前端架构改造、中国式日报、日报截图等需求。其中在做这个项目中遇到的最大困难时是微前端架构改造这个需求，该需求背景是最开始做京数通 2.0 系统重构的时候，因为在最开始 1.0，实时看板是基于 iframe 的方式接入的。而当时基于老项目技术的限制，没有做微前端改造。而后在重构重提了这次需求，我是本次需求的负责人。

<!-- 而后我主要调研了公司内部以及外部成熟的微前端框架，最终选定了 qiankun。 -->

<!-- 该项目主要的功能模块：自定义报表（能通过底层平台提供的能力（源数据平台），每个报表对应一个数据源和多个维度指标等自定义配置化报表），自定义看板（通过报表的权限及其指标，用户能够自定义配置看板数据。）、中国式日报（复杂报表，支持多个数据源混用配置日报。并且支持固定化的分维度看数，并支持数据订阅日报）等功能。 -->

## 重难点

在微前端改造的时候，我主要碰到最大的难题是：

1. 两个子应用之间相互切换数据缓存问题

   - 问题：
     如果是同一个应用中。以 vue 举例，常用的解决方案就是用 v-show（它本质是通过 display:none 来解决的）；如果是组件缓存，则是用 keep-alive 组件进行缓存。
     但是对于两个子应用来说：缓存被没有生效，每次切换两个子应用都会加载子应用和渲染子应用。并且之前用过 keep-alive 缓存的话，缓存也会失效。

   - 两个解决方案：
     1. 在主应用中用不同的 dom 控制不同的子应用渲染，然后通过
        `<div id="appContainer1" v-show="$route.path.startsWith('/app-vue-hash/')"></div>`
        控制子应用 dom 显示哪一个子应用
        初始化时通过 loadMicroApp 手动控制加载哪个子应用
        路由切换时则由 v-show 控制
        - 优点
          - 实现简单，v-show 来满足
          - 不需要卸载子应用，页签切换速度比较快
        - 缺点
          - 只能控制自己系统的改造
          - 子应用切换时不销毁 DOM，会导致 DOM 节点和事件监听过多，严重时会造成页面卡顿
     2. registerMicroApps 注册所以子应用，然后 start 开启预加载，并且开启 singular 多实例模式。通过 patch-package 的方式来修改 qiankun 源码的 loader.js 这个文件。修改子项目的 render()和 unmount()方法
        子应用切换的时候会触发各自子应用的生命周期
        即增加判断如果 `!getContainer(initialContainer).firstChild` 的实例不存在，才执行生命周期。
        否则跳过。

2.
