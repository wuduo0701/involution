## HTTP

> 超文本传输协议，OSI7 层网络模型中的传输层（第五层）的协议，或是一种表示信息的规范顺序和语法

Web 服务器将以纯文本形式与您的浏览器交换数据

### 弊端

1. 明文传输，使用纯文本进行数据交换，内容很容易被窃听
2. 不验证对方的身份，可能会被伪装者攻击

## HTTPS

> 超文本传输安全协议，HTTPS 使用的还是 HTTP 进行传输，但是使用了 SSL/TLS 技术加密了数据包。使得传输更安全

<!-- - 通常 HTTP 先和 TCP 进行通信；当使用 HTTPS 时，则变成先和 SSL 新通信，在和 TCP 进行通信。听着 HTTPS 就是身披 SSL 协议外层的 HTTP。 -->

- 先 tcp 连接，在 tls 握手

### 为什么就比 HTTP 安全

HTTPS 的安全主要由 SSL 保证的、`SSL`的实现主要依赖下述三种手段：

- 对称加密：采用协商的密钥对数据加密

  > 加密和解密都用的一个秘钥，需要保证这个秘钥的安全性

  比喻：和好朋友之间有一个共享的秘密代码本，只有两个人知道内容。每次我和好朋友交流，都把消息通过密码本的内容加密和解密。（需要严格保证密码本的内容）

- 非对称加密：实现身份认证和密钥协商

  > 存在两个秘钥：一个叫公钥，一个叫私钥。公钥可以公开给任何人使用，私钥则需要保密
  > 公钥和私钥都可以用来加密解密，但公钥加密后只能用私钥解密；反过来，私钥加密后也只能用公钥解密
  > RSA 算法

  比喻：有两种锁，一种是公钥（可以给任何人），一种是私钥（只有自己知道）。任何人传递消息时都可以用公钥锁上，但是只能通过私钥解开。

- 摘要算法：验证信息的完整性

  > 将任意长度的输入数据通过算法转化成固定的值（哈希值）的算法，如常用的`MD5`、`SHA-256`，具有以下特点：

  - 固定长度输出：无论数据是多大的，总是会输出一个固定的 hash 值
  - 唯一性：只要输入的数据有一点不同，都会造成 hash 变化
  - 不可逆：无法从 hash 推算出输入的数据
  - 高效性：计算速度快，适合处理大数据量

- 数字签名：身份验证
  > 使用权威机构颁发的证书，这个权威机构称为 CA（Certificate Authority），颁发的证书就称为数字证书
  - 通过数字证书向浏览器证明服务器的身份
  - 数字证书里面包含了服务器公钥。

## HTTP 和 HTTPS 的区别

1. HTTP 是明文传输的，是不安全的。HTTPS 使用了 SSL/TLS 加密处理，相对更安全
2. 端口不一致。HTTP 的默认端口是 80，HTTPS 的默认端口是 443
3. HTTPS 需要经过多次握手以及加密，性能上不如 HTTP

## HTTPS 加密解密过程

> 在传输数据阶段依然使用对称加密，但是对称加密的密钥我们采用非对称加密来传输

1. 首先浏览器向服务器发送对称加密套件列表、非对称加密套件列表和随机数 client-random。
2. 服务器保存随机数 client-random，选择对称加密和非对称加密的套件，然后生成随机数 service-random，向浏览器发送选择的加密套件、service-random 和公钥。
3. 浏览器保存公钥，并生成随机数 pre-master，然后利用公钥对 pre-master 加密，并向服务器发送加密后的数据。
4. 最后服务器拿出自己的私钥，解密出 pre-master 数据，并返回确认消息。

### 解答

<!-- 1. 客户端发起 HTTPS 请求。发送对称加密和非对称加密的加密套件、客户端随机数
2. 服务器返回 SSL/TLS 证书
3. 客户端会验证 CA 证书。有没有过期
4. 没有过期的话，客户端会生成一个秘钥，并使用服务器的公钥进行加密。
5. 客户端会把这个秘钥发送给服务器。只有服务器的私钥才能解密
6. 服务器使用自己的私钥解密客户端发送的会话密钥，得到对称加密密钥（会话密钥）。
7. 接下来的传输都会用对称加密传输 -->

1. 客户端发起 HTTPS 请求 发送对称加密和非对称加密的加密套件列表、客户端随机数
2. 服务器选择加密套件，并发送服务器的随机数、CA 证书、公钥
3. 客户端验证证书有效期
4. 客户端生成预主密钥，使用服务器的公钥以及选择的非对称加密算法进行加密，发送给服务器
5. 服务器用私钥解密预主密钥。（不需要发送回客户端确认，因为服务器知道加密套件，以及随机数，只需要解出预主密钥就可以）
6. 使用客户端随机数、服务器随机数、预主密钥结合对称加密。生成最终的对称加密密钥
7. 对称加密传输数据
