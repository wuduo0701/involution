# 输入 url 到敲下回车发生了什么

总结：

- url 解析
- DNS 解析
- TCP 连接（三次握手）
- 发送 HTTP 请求
- 响应请求（四次挥手）
- 页面渲染

## url 解析

首先判断输入的是 url 还是搜索关键词，

- 如果是搜索关键词
  > 会对搜索内容进行编码转化成搜索内容
- 如果是 URL
  > 会判断 URL 是否合理，然后到对应的服务器拿相应 URL 的资源。即 协议 + 服务器/域名 +（端口）+ 资源路径 + 请求描述

## DNS 解析

> 简单来说就是将域名转化成 ip 的过程

### 域名

从上到下分为根域名、顶级域名、二级域名、三级域名。如`www.baidu.com`。www 为三级域名、xxx 为二级域名、com 为顶级域名，除此之外还有电脑默认的本地域名服务器（网络服务提供商自动提供的用于解析域名的服务器）

### 查询流程

> 简单总结：优先查缓存（浏览器缓存 -> 操作系统缓存 -> 本地服务器缓存）、向上级域名服务器查找（迭代查询）、缓存 IP 地址（本地服务器、操作系统、浏览器都缓存一遍）
> ！！分迭代和递归查询方式，迭代相比于递归更简单

1. 先搜寻浏览器的 DNS 缓存
2. 如为找到，继续搜索操作系统缓存
3. 还未找到，继续搜索本地服务器的缓存
4. 如都为命中缓存，则会由本地服务器向上级域名进行迭代查询（本地服务器发起 -> 根域名服务器，告诉.com 由哪一个顶级域名管理 -> 顶级域名服务器，告诉 baidu.com 由 xxx 管理 -> 直到最终能够找到这个域名的 IP 地址）。简单来说：也是一问一答式，如无法最终解析，就会返回下一个 DNS 服务器地址，让本地服务器继续查找，知道最终找到
5. 进行缓存。本地服务器、操作系统、浏览器都缓存一遍 IP 地址

## TCP 连接 - 三次握手

> TCP 协议（应用层、传输层、网络层、链路层）

1. 【SYN_SENT】客户点向服务器发送一个`SYN`报文给服务器，开始进行 TCP 连接，该`SYN`包含了客户端的`ISN`序列号(seq)。（发送：SYN: 1,Seq = x）
   > 客户端的发送能力、服务端的接收能力是正常的。
2. 【SYN_RCVD】服务器收到客户端的`SYN`报文后，会发生一个`SYN-ACK`报文作为相应，表示服务器收到了请求。（发送自己的 SYN：1,ACK:1,seq: y, 加上客户端的 seq：x+1 作为 ack 的值）
   > 服务器的发生能力、客户端的接收能力是正常的，不过服务器不能判断客户端的接收能力是否正常
   - 其中 SYN 是服务器自己的，ACK 是客户端的 ISN + 1（初始化序列号 + 1）
   - 会发送四个：自己的（SYN 标志、ACK 标志、isn 序列号）、客户端的（ack 值：客户端的初始化序列号 + 1）
3. 【ESTABLISHED】客户端在收到服务器发送的`SYN-ACK`报文后，会返回给服务器`ACK`字段，正式建立链接。（发送自己的 ACK、seq：x + 1, 服务器的：ack 值：服务器的 y+1）
   > 客户端的接收、发送能力正常，服务器的发送、接收能力也正常

## HTTP 请求 - 发送数据
