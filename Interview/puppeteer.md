首先，说明需求和背景，让面试官明白你做的是个什么事情，为何是个难点，难在哪里？ —— 这很重要。
然后，说明解决方案，通过什么途径、什么方式、什么技术，来解决这些难点。注意，这里要多说一些技术名词，体现技术解决方案。
最后，说明解决以后的成果，带来了什么价值

项目难点尽量规模大一些。例如说一些技术方案的设计，这可以更加全面、完整的体现自己的技术能力

# 前端截图服务

前端截图服务
技术栈：Egg.js + puppeteer + async + html2canvas
项目描述：

- 截图服务是一个基于 Node.js 的前端服务，通过接口调度模拟用户登录目标系统。使用 puppeteer 无头浏览器访问目标 URL 页面进行截图，完成后通过邮件方式发送给用户。
- 作为项目负责人，独立完成了系统的设计和开发，包括技术选型、系统架构设计、代码实现。
- 针对多个复杂表格的页面，优化了截图策略，显著提高了截图的清晰度和质量。
- 通过限流策略将系统 CPU 及内存使用率从 80%降低到 30%，有效解决了服务偶发超载的问题。

<!-- - 增加了接口错误拦截机制、错误重试机制、监控告警、日志等功能。 -->

## 项目介绍

截图服务是一个 Node 前端服务，基于 Egg 框架开发的。我是这个项目的负责人，初始是做京数通中国式日报衍生出来的需求，也就是日报服务。目前已经抽离出来做成了一个通用的前端服务，支持自定义输入网页地址，进行截图操作，并且支持多个复杂报表，已接入组内三个系统，即京数通日报服务，crm 和算盘的下载服务。使用方法是通过接口调度模拟用户登录目标系统，（需要该系统的服务支持模拟登录），需要提供关键的参数（URL，权限 header，是否 dom 截图），截图服务会把权限参数放在请求 header 中，跳过权限。而后使用 puppeteer 无头浏览器访问目标 URL 页面进行截图，完成后通过邮件方式发送给用户。

遇到的问题：有两次性能瓶颈。一个是截取中国式日报，这种多个负责报表融合的页面，调取截图操作会存在 cpu 和内存拉满的情况。一个是高峰期调度，会存在高并发的情况，存在多个页面进行渲染截图，导致性能拉满后偶发请求失败的情况。

## 难点

1. 性能资源提升
   - 需求和背景
     1. 项目部署的时候，发现在本地服务可以正常运行。但是只要部署到服务器上后，会一直存在截图超时、无响应、以及 CPU 打满的情况。
     2. 调研发现：
        1. 在服务器环境中渲染复杂的页面是一个很耗 CPU 的工作，而且服务器上没有 GPU 硬件加速支持，所以在客户端和服务器中表现不一致。
        2. puppeteer 提供的截图 API 是浏览器提供的原生 API。这个 API 浏览器处理大量 DOM 节点计算，回流操作，存在性能瓶颈，并且用这个截取大图存在布局混乱的情况。
        3. 每次调用服务就相当于启一个窗口执行渲染以及截图。在用户量大的时候，就会存在抢占资源的情况。会偶发用户发送日报失败的问题。
   - 难点以及解决方案
     1. 截图采用了 html2canvas 进行截图，html2canvas 在截取长截图有显著的优势。
        1. 浏览器对 Canvas 操作和渲染性能进行了大量优化
        2. 对内存做了优化使用
     2. 对截图做了限流+排队的策略限制
        1. egg 中有 worker 的概念，其实就是进程。限制进程的并发量
        2. 对于每个进程来说，增加最大的接口调度量，即排队。
        3. 但是排队不意味着不接受新请求了。对后端调取服务，采用同步处理机制。截图服务采用异步处理。这样接口调度就无需等待了。
        4. 并且对系统增加了全链路系统保障。错误重试机制、日志等功能

## 项目复盘及经验总结能力

1. 通用的抽象解决能力。遇到问题能不能抽象出通用的解决方案
2. 在做 node 后台服务的时候，不能以前端的角度去思考问题。
   1. 如刚说的项目部署，因为前端服务是静态资源类，消耗的机器资源不多。而后台服务需要同时消耗更多的资源
   2. 如服务并发情况。常用的后台前端服务，其实不需要去考虑这个问题，因为再大的用户量，它也只是请求静态资源，并发量并不会太高。而对于后台服务，则需要考虑更多的并发请求量，资源利用率情况、错误机制、日志链路排查等等，需要更加完善的去考虑系统。
   <!-- 1. 截图表格滚动区域+截图错乱问题
           - 需求和背景
             1. 需求是基于对页面权限的页面做模拟登录截图发日报的，而表格是存在滚动区域的（横向滚动+竖向滚动）。
                1. 截图部分区域横向 + 竖向滚动区域，通过调用原生截取 node 的是可以
                2. puppeteer 提供了原生截图 API，但是这个截图多个长 dom 会出现布局混乱的问题。经过调研后发现这个 API 用的是浏览器截图命令。而浏览器在处理大量 DOM 节点，会出现性能瓶颈，而且服务是部署在容器里的，小核容器性能是比不过电脑的，而在京数通的中国式日报中存在多个复杂表格组合的情况。基于这个需求背景改变了思路，使用 puppeteer 进行无头浏览器模拟登录渲染页面，而后通过调用 html2canvas 进行截图，html2canvas 在截取长截图有显著的优势。
                   1.
                3.
           - 难点以及解决方案
             1. -->

# TODO

1. 完善项目的介绍，介绍的时候带着难点，可以白话文一点
